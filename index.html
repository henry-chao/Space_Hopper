<!DOCTYPE html>
<html>
<head>
    <script src="/js/phaser.min.js"></script>
    <title>Space Hopper</title>
</head>
<body>

    <script>
    const currentPlanetX = 300;
    const currentPlanetY = 500;
    const leftPlanetX = 650;
    const leftPlanetY = 200;
    const rightPlanetX = 800;
    const rightPlanetY = 400;
    const fuelMax = 20;
    const cargoMax = 150;
    const planetNames = ["Mercury", "Venus", "Mars", "Earth", "Jupiter", "Pluto", "Saturn", "Neptune", "Uranus"];
    const planetImages = ["PlanetA", "PlanetB", "PlanetC"];

    var SpaceScene = new Phaser.Class({
      Extends: Phaser.Scene,

      initialize: function SpaceScene () {
        Phaser.Scene.call(this, {key: 'SpaceScene' });
      },

      preload: function ()
      {
          this.load.image('ship', 'assets/sprites/ship.png');
          this.load.image('PlanetA', 'assets/sprites/Planet_A.png');
          this.load.image('PlanetB', 'assets/sprites/Planet_B.png');
          this.load.image('PlanetC', 'assets/sprites/Planet_C.png');
      },

      create: function ()
      {
        this.planetIndicator;
        this.fuelIndicator;
        this.cargoIndicator;
        this.moneyIndicator;

        this.fuelCount = 20;
        this.cargoCount = 0;
        this.moneyCount = 1500;

        this.currentPlanet, this.leftPlanet, this.rightPlanet, this.leftline, this.rightline;
        this.playerShip;

        this.playerShip = this.add.sprite(currentPlanetX - 16, currentPlanetY - 16, 'ship').setOrigin(0, 0);
        this.rotatePlayerShip("rest");

        this.createGalaxy();
        this.currentPlanet = this.generatePlanet(currentPlanetX, currentPlanetY);

      	this.planetIndicator = this.add.text(16, 16,
      		"Planet Earth",
    	  	{fontSize: '30px', fill: '#ffffff'}
      	);
        this.fuelIndicator = this.add.text(16, 740,
          this.displayFuel(),
          {fontSize: '30px', fill: '#ffffff'}
        );
        this.cargoIndicator = this.add.text(260, 740,
          this.displayCargo(),
          {fontSize: '30px', fill: '#ffffff'}
        );
        this.moneyIndicator = this.add.text(556, 740,
          this.displayMoney(),
          {fontSize: '30px', fill: '#ffffff'}
        );
      },

      displayFuel: function() {
        return "Fuel: " + this.fuelCount + "/" + fuelMax;
      },

      displayCargo: function() {
        return "Cargo: " + this.cargoCount + "/" + cargoMax;
      },

      displayMoney: function() {
        return "Money: $" + this.moneyCount;
      },

      rotatePlayerShip: function (position) {
        const leftAngle = Math.atan2(currentPlanetY - leftPlanetY, leftPlanetX - currentPlanetX) * 180 / Math.PI;
        const rightAngle = Math.atan2(currentPlanetY - rightPlanetY, rightPlanetX - currentPlanetY) * 180 / Math.PI;
        let angle = (position === "rest" ? 0 : (position === "left" ? 90 - leftAngle : 90 - rightAngle));
        this.playerShip.angle = angle;
        this.playerShip.depth = 10;
      },

      createGalaxy: function () {
        this.drawLines();

        this.leftPlanet = this.generatePlanet(leftPlanetX, leftPlanetY);
        this.rightPlanet = this.generatePlanet(rightPlanetX, rightPlanetY);
      },

      drawLines: function () {
        this.leftline = this.add.line(0, 0, currentPlanetX, currentPlanetY, leftPlanetX, leftPlanetY, 0xffff00).setOrigin(0,0);
        this.rightline = this.add.line(0, 0, currentPlanetX, currentPlanetY, rightPlanetX, rightPlanetY, 0xffff00).setOrigin(0,0);
        this.leftline.depth = -1;
        this.rightline.depth = -1;
      },

      generatePlanet: function (x, y) {
        var planet = this.add.image(x, y, Phaser.Math.RND.pick(planetImages));
        planet.setInteractive();

        planet.on('pointerdown', () => {
          let planetName = "Planet " + Phaser.Math.RND.pick(planetNames);

          let x_offset = (x === leftPlanetX) ? leftPlanetX - currentPlanetX : rightPlanetX - currentPlanetX;
          let y_offset = (y === leftPlanetY) ? currentPlanetY - leftPlanetY : currentPlanetY - rightPlanetY;

          if (planet != this.currentPlanet) {
            this.planetIndicator.setText(planetName);

            this.leftline.destroy();
            this.rightline.destroy();
            (x === leftPlanetX) ? this.rotatePlayerShip("left") : this.rotatePlayerShip("right");

            this.tweens.add({
              targets: [this.currentPlanet, this.leftPlanet, this.rightPlanet],
              x: "-=" + x_offset,
              y: "+=" + y_offset,
              duration: 3000,
              onComplete: () => {
                this.currentPlanet.destroy();
                this.currentPlanet = planet;
                (x === leftPlanetX) ? this.rightPlanet.destroy() : this.leftPlanet.destroy();
                this.createGalaxy();
                this.rotatePlayerShip("rest");
              },
            });
          }
        });

        this.tweens.add({
          targets: planet,
          angle: 360,
          duration: 6000,
          repeat: -1,
        });

        return planet;
       },
    });

    var config = {
        type: Phaser.AUTO,
        width: 1200,
        height: 800,
	      canvasStyle: "display: block; margin-left: auto; margin-right: auto;",
        physics: {
            default: 'arcade',
        },
        scene: [SpaceScene]
    };

    var game = new Phaser.Game(config);
    </script>

</body>
</html>
